
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML is auto-generated from an M-file.
To make changes, update the M-file and republish this document.
      --><title>do_accuracy_concanated_turbines_benchmarking_10_analogs</title><meta name="generator" content="MATLAB 7.10"><meta name="date" content="2012-05-14"><meta name="m-file" content="do_accuracy_concanated_turbines_benchmarking_10_analogs"><style type="text/css">

body {
  background-color: white;
  margin:10px;
}

h1 {
  color: #990000; 
  font-size: x-large;
}

h2 {
  color: #990000;
  font-size: medium;
}

/* Make the text shrink to fit narrow windows, but not stretch too far in 
wide windows. */ 
p,h1,h2,div.content div {
  max-width: 600px;
  /* Hack for IE6 */
  width: auto !important; width: 600px;
}

pre.codeinput {
  background: #EEEEEE;
  padding: 10px;
}
@media print {
  pre.codeinput {word-wrap:break-word; width:100%;}
} 

span.keyword {color: #0000FF}
span.comment {color: #228B22}
span.string {color: #A020F0}
span.untermstring {color: #B20000}
span.syscmd {color: #B28C00}

pre.codeoutput {
  color: #666666;
  padding: 10px;
}

pre.error {
  color: red;
}

p.footer {
  text-align: right;
  font-size: xx-small;
  font-weight: lighter;
  font-style: italic;
  color: gray;
}

  </style></head><body><div class="content"><pre class="codeinput"><span class="keyword">function</span> [ succes ] = do_accuracy_concanated_turbines_benchmarking_10_analogs( Namelist )
<span class="comment">%DO_ACCURACY_NWP_ANALYSIS Summary of this function goes here</span>
<span class="comment">%   Detailed explanation goes here</span>
close <span class="string">all</span>
    exp_name=<span class="string">'Turbine_by_turbine_winter_1_mslp_wspd_wdir_rho_shear_domaine_3'</span> <span class="comment">% this is bad and should be cahnged 14/05</span>
    file_path=[<span class="string">'C:\Users\jnini\MATLAB\work\AnEn\data\workspace\ETA\out\experiments\'</span>,exp_name]
    load([file_path,<span class="string">'\turbine_time_series_for_nr_analogs_10'</span>])
    leadtime_vector=get_leadtime_vector(turbine_time_series,Namelist)'
    [ analogs_lead_times ] = get_analog_lead_times( Namelist );

    <span class="keyword">for</span> j=analogs_lead_times
        obs=[];model=[];model_reg=[];model_raw=[];
        [m n]=size(turbine_time_series)
        <span class="keyword">for</span> i=1:n
            <span class="comment">% concanate loop</span>
            good_idx{i}=find(turbine_time_series(1,i).data{2,15}~=Namelist{1}.missing_value &amp; leadtime_vector==j);
            obs=vertcat(turbine_time_series(1,i).data{2,15}(good_idx{i}),obs);
            model=vertcat(turbine_time_series(1,i).data{2,2}(good_idx{i}),model);
            model_reg=vertcat(turbine_time_series(1,i).data{2,19}(good_idx{i}),model_reg);
            model_raw=vertcat(turbine_time_series(1,i).data{2,20}(good_idx{i}),model_raw);
        <span class="keyword">end</span>

        <span class="keyword">if</span> not(isempty(obs))
                <span class="keyword">if</span> Namelist{10}.normalize_errors
                   [ETA_rmse_analogs_10(j) ETA_bias_analogs_10(j) ETA_crmse_analogs_10(j)] = RMSEdecomp_all(obs/Namelist{10}.rated_capasity_kw, model/Namelist{10}.rated_capasity_kw);
                   [ETA_rmse_regresion(j) ETA_bias_regresion(j) ETA_crmse_regresion(j)] = RMSEdecomp_all(obs/Namelist{10}.rated_capasity_kw, model_reg/Namelist{10}.rated_capasity_kw);
                   [ETA_rmse_raw(j) ETA_bias_raw(j) ETA_crmse_raw(j)] = RMSEdecomp_all(obs/Namelist{10}.rated_capasity_kw, model_raw/Namelist{10}.rated_capasity_kw);

                   ETA_NMAE_analogs_10(j)=mean(abs(obs-model)/Namelist{10}.rated_capasity_kw);
                   ETA_NMAE_regresion(j)=mean(abs(obs-model_reg)/Namelist{10}.rated_capasity_kw);
                   ETA_NMAE_raw(j)=mean(abs(obs-model_raw)/Namelist{10}.rated_capasity_kw);
                    ETA_pearson_analogs_10(j)=corr(obs,model, <span class="string">'Type'</span>, <span class="string">'Pearson'</span>);
                    ETA_pearson_regresion(j)=corr(obs,model_reg, <span class="string">'Type'</span>, <span class="string">'Pearson'</span>);
                    ETA_pearson_raw(j)=corr(obs,model_raw, <span class="string">'Type'</span>, <span class="string">'Pearson'</span>);

                    ETA_spearman_rank_correltion_analogs_10(j)=corr(obs,model, <span class="string">'Type'</span>, <span class="string">'Spearman'</span>);
                    ETA_spearman_rank_correltion_regresion(j)=corr(obs,model_reg, <span class="string">'Type'</span>, <span class="string">'Spearman'</span>);
                    ETA_spearman_rank_correltion_raw(j)=corr(obs,model_raw, <span class="string">'Type'</span>, <span class="string">'Spearman'</span>);
                <span class="keyword">else</span>
                   [ETA_rmse_regresion(j) ETA_bias_analogs10(j) ETA_crmse_10(j)] = RMSEdecomp_all(obs, model);
                    ETA_NMAE_10(j)=mean(abs(obs-model))
                    ETA_pearson_10(j)=corr(obs,model, <span class="string">'Type'</span>, <span class="string">'Pearson'</span>);
                    ETA_spearman_rank_correltion_10(j)=corr(obs,model, <span class="string">'Type'</span>, <span class="string">'Spearman'</span>);
                <span class="keyword">end</span>
        <span class="keyword">else</span> <span class="comment">%isempty</span>
                     ETA_rmse_analogs_10(j) =mean(ETA_rmse_analogs_10(12:j-1));
                     ETA_bias_analogs10(j) =mean(ETA_bias_analogs_10(12:j-1));
                     ETA_crmse_analogs_10(j) = mean(ETA_rmse_analogs_10(12:j-1));
                     ETA_NMAE_analogs_10(j)=mean(ETA_NMAE_analogs_10(12:j-1));
                     ETA_spearman_rank_correltion_analogs_10(j)=mean(ETA_spearman_rank_correltion_analogs_10(12:j-1))

                     ETA_rmse_regresion(j) =mean(ETA_rmse_regresion(12:j-1));
                     ETA_bias_regresion(j) =mean(ETA_bias_regresion(12:j-1));
                     ETA_crmse_regresion(j) = mean(ETA_rmse_regresion(12:j-1));
                     ETA_NMAE_regresion(j)=mean(ETA_NMAE_regresion(12:j-1));
                     ETA_spearman_rank_correltion_regresion(j)=mean(ETA_spearman_rank_correltion_regresion(12:j-1))

                     ETA_rmse_raw(j) =mean(ETA_rmse_raw(12:j-1));
                     ETA_bias_raw(j) =mean(ETA_bias_raw(12:j-1));
                     ETA_crmse_raw(j) = mean(ETA_rmse_raw(12:j-1));
                     ETA_NMAE_raw(j)=mean(ETA_NMAE_raw(12:j-1));
                     ETA_spearman_rank_correltion_raw(j)=mean(ETA_spearman_rank_correltion_raw(12:j-1))
        <span class="keyword">end</span>
 <span class="keyword">end</span>

    clear <span class="string">turbine_time_series</span>;clear <span class="string">obs</span>;clear <span class="string">model</span>
    exp_name_wrf=<span class="string">'Turbine_by_turbine_winter_1_mslp_wspd_wdir_rho_shear_domaine_3'</span>
    file_path=[<span class="string">'C:\Users\jnini\MATLAB\work\AnEn\data\workspace\WRF\out\experiments\'</span>,exp_name_wrf]
    load([file_path,<span class="string">'\turbine_time_series_for_nr_analogs_10'</span>]);Namelist{4}.nwp_model_domain=3;Namelist{4}.nwp_model{1}=<span class="string">'WRF'</span>
    leadtime_vector=get_leadtime_vector(turbine_time_series,Namelist)'
    [ analogs_lead_times_d3 ] = get_analog_lead_times( Namelist );

    <span class="keyword">for</span> j=analogs_lead_times
        obs=[];model=[];model_reg=[];model_raw=[];

    <span class="comment">% gets the index where obervation are not missing for each turbine</span>
    [m n]=size(turbine_time_series)
        <span class="keyword">for</span> i=1:n
             <span class="comment">% concanate loop</span>
            good_idx{i}=find(turbine_time_series(1,i).data{2,15}~=Namelist{1}.missing_value &amp; leadtime_vector==j);
            obs=vertcat(turbine_time_series(1,i).data{2,15}(good_idx{i}),obs);
            model=vertcat(turbine_time_series(1,i).data{2,2}(good_idx{i}),model);
            model_reg=vertcat(turbine_time_series(1,i).data{2,19}(good_idx{i}),model_reg);
            model_raw=vertcat(turbine_time_series(1,i).data{2,20}(good_idx{i}),model_raw);
        <span class="keyword">end</span>
           <span class="keyword">if</span> not(isempty(good_idx{i}))
            <span class="keyword">if</span> Namelist{10}.normalize_errors
                [WRF_d3_rmse_analogs_10(j) WRF_d3_bias_analogs_10(j) WRF_d3_crmse_analogs_10(j)] = RMSEdecomp_all(obs/Namelist{10}.rated_capasity_kw, model/Namelist{10}.rated_capasity_kw);
                WRF_d3_NMAE_regresion(j)=mean(abs(obs-model_reg)/Namelist{10}.rated_capasity_kw)
                WRF_d3_NMAE_raw(j)=mean(abs(obs-model_raw)/Namelist{10}.rated_capasity_kw)

                [WRF_d3_rmse_regresion(j) WRF_d3_bias_regresion(j) WRF_d3_crmse_regresion(j)] = RMSEdecomp_all(obs/Namelist{10}.rated_capasity_kw, model_reg/Namelist{10}.rated_capasity_kw);
                WRF_d3_NMAE_regresion(j)=mean(abs(obs-model)/Namelist{10}.rated_capasity_kw)
                [WRF_d3_rmse_raw(j) WRF_d3_bias_raw(j) WRF_d3_crmse_raw(j)] = RMSEdecomp_all(obs/Namelist{10}.rated_capasity_kw, model_raw/Namelist{10}.rated_capasity_kw);
                WRF_d3_NMAE_analogs_10(j)=mean(abs(obs-model)/Namelist{10}.rated_capasity_kw)
                WRF_d3_pearson_analogs_10(j)=corr(obs,model, <span class="string">'Type'</span>, <span class="string">'Pearson'</span>);
                WRF_d3_pearson_regresion(j)=corr(obs,model_reg, <span class="string">'Type'</span>, <span class="string">'Pearson'</span>);
                WRF_d3_pearson_raw(j)=corr(obs,model_raw, <span class="string">'Type'</span>, <span class="string">'Pearson'</span>);
                WRF_d3_spearman_rank_correltion_analogs_10(j)=corr(obs,model, <span class="string">'Type'</span>, <span class="string">'Spearman'</span>);
                WRF_d3_spearman_rank_correltion_regresion(j)=corr(obs,model_reg, <span class="string">'Type'</span>, <span class="string">'Spearman'</span>);
                WRF_d3_spearman_rank_correltion_raw(j)=corr(obs,model_raw, <span class="string">'Type'</span>, <span class="string">'Spearman'</span>);

            <span class="keyword">else</span>
                [WRF_d3_rmse_analogs_10(j) WRF_d3_bias_analogs10(j) WRF_d3_crmse_10(j)] = RMSEdecomp_all(obs, model);
                WRF_d3_NMAE_10(j)=mean(abs(obs-model))
                WRF_d3_pearson_10(j)=corr(obs,model, <span class="string">'Type'</span>, <span class="string">'Pearson'</span>);
                WRF_d3_spearman_rank_correltion_10(j)=corr(obs,model, <span class="string">'Type'</span>, <span class="string">'Spearman'</span>);
            <span class="keyword">end</span> <span class="comment">% normalize</span>

           <span class="keyword">else</span> <span class="comment">% is empty</span>
                WRF_d3_rmse_analogs_10(j)=mean(WRF_d3_rmse_analogs_10(12:j-1))
                 WRF_d3_bias_analogs10(j)=mean(WRF_d3_bias_analogs_10(12:j-1))
                 WRF_d3_crmse_analogs_10(j) = mean(WRF_d3_crmse_analogs_10(12:j-1))
                WRF_d3_NMAE_analogs_10(j)=mean(WRF_d3_NMAE_analogs_10(12:j-1))
                WRF_d3_pearson_analogs_10(j)=mean(WRF_d3_pearson_analogs_10(12:j-1))
                WRF_d3_spearman_rank_correltion_analogs_10(j)=mean(WRF_d3_spearman_rank_correltion_analogs_10(12:j-1))
           <span class="keyword">end</span> <span class="comment">% is empty</span>
    <span class="keyword">end</span> <span class="comment">% lead time</span>

    exp_name_wrf=<span class="string">'Turbine_by_turbine_winter_1_mslp_wspd_wdir_rho_shear_domaine_2'</span>
    file_path=[<span class="string">'C:\Users\jnini\MATLAB\work\AnEn\data\workspace\WRF\out\experiments\'</span>,exp_name_wrf]
    load([file_path,<span class="string">'\turbine_time_series_for_nr_analogs_10'</span>])
    Namelist{4}.nwp_model_domain=2
    leadtime_vector=get_leadtime_vector(turbine_time_series,Namelist)'
    [ analogs_lead_times_d2 ] = get_analog_lead_times( Namelist );

    <span class="comment">% gets the index where obervation are not missing for each turbine</span>
    <span class="keyword">for</span> j=analogs_lead_times_d2
        obs=[];model=[];model_reg=[];model_raw=[];

    <span class="comment">% gets the index where obervation are not missing for each turbine</span>
    [m n]=size(turbine_time_series)
        <span class="keyword">for</span> i=1:n
            good_idx{i}=find(turbine_time_series(1,i).data{2,15}~=Namelist{1}.missing_value &amp; leadtime_vector==j);
            obs=vertcat(turbine_time_series(1,i).data{2,15}(good_idx{i}),obs);
            model=vertcat(turbine_time_series(1,i).data{2,2}(good_idx{i}),model);
            model_reg=vertcat(turbine_time_series(1,i).data{2,19}(good_idx{i}),model_reg);
            model_raw=vertcat(turbine_time_series(1,i).data{2,20}(good_idx{i}),model_raw);
        <span class="keyword">end</span> <span class="comment">% turbine id</span>
           <span class="keyword">if</span> not(isempty(obs))
             <span class="keyword">if</span> Namelist{10}.normalize_errors
                [WRF_d2_rmse_analogs_10(j) WRF_d2_bias_analogs_10(j) WRF_d2_crmse_analogs_10(j)] = RMSEdecomp_all(obs/Namelist{10}.rated_capasity_kw, model/Namelist{10}.rated_capasity_kw);
                WRF_d2_NMAE_regresion(j)=mean(abs(obs-model_reg)/Namelist{10}.rated_capasity_kw)
                WRF_d2_NMAE_raw(j)=mean(abs(obs-model_raw)/Namelist{10}.rated_capasity_kw)

               [WRF_d2_rmse_regresion(j) WRF_d2_bias_regresion(j) WRF_d2_crmse_regresion(j)] = RMSEdecomp_all(obs/Namelist{10}.rated_capasity_kw, model_reg/Namelist{10}.rated_capasity_kw);
               WRF_d2_NMAE_regresion(j)=mean(abs(obs-model)/Namelist{10}.rated_capasity_kw)

                [WRF_d2_rmse_raw(j) WRF_d2_bias_raw(j) WRF_d2_crmse_raw(j)] = RMSEdecomp_all(obs/Namelist{10}.rated_capasity_kw, model_raw/Namelist{10}.rated_capasity_kw);
                WRF_d2_NMAE_analogs_10(j)=mean(abs(obs-model)/Namelist{10}.rated_capasity_kw)

                WRF_d2_pearson_analogs_10(j)=corr(obs,model, <span class="string">'Type'</span>, <span class="string">'Pearson'</span>);
                WRF_d2_pearson_regresion(j)=corr(obs,model_reg, <span class="string">'Type'</span>, <span class="string">'Pearson'</span>);
                WRF_d2_pearson_raw(j)=corr(obs,model_raw, <span class="string">'Type'</span>, <span class="string">'Pearson'</span>);

                WRF_d2_spearman_rank_correltion_10(j)=corr(obs,model, <span class="string">'Type'</span>, <span class="string">'Spearman'</span>);
                WRF_d2_spearman_rank_correltion_regresion(j)=corr(obs,model_reg, <span class="string">'Type'</span>, <span class="string">'Spearman'</span>);
                WRF_d2_spearman_rank_correltion_raw(j)=corr(obs,model_raw, <span class="string">'Type'</span>, <span class="string">'Spearman'</span>);

            <span class="keyword">else</span>
                [WRF_d2_rmse_analogs_10(j) WRF_d2_bias_analogs10(j) WRF_d2_crmse_10(j)] = RMSEdecomp_all(obs, model);
                WRF_d2_NMAE_10(j)=mean(abs(obs-model))
                WRF_d2_pearson_10(j)=corr(obs,model, <span class="string">'Type'</span>, <span class="string">'Pearson'</span>);
                WRF_d2_spearman_rank_correltion_10(j)=corr(obs,model, <span class="string">'Type'</span>, <span class="string">'Spearman'</span>);
            <span class="keyword">end</span>
           <span class="keyword">else</span> <span class="comment">% is empty</span>
                WRF_d2_rmse_analogs_10(j)=mean(WRF_d2_rmse_analogs_10(find(WRF_d2_rmse_analogs_10~=0)) );
                WRF_d2_bias_analogs10(j)=mean(WRF_d2_bias_analogs_10(find(WRF_d2_bias_analogs_10~=0)) );
                WRF_d2_crmse_analogs_10(j) = mean(WRF_d2_crmse_analogs_10(find(WRF_d2_crmse_analogs_10~=0)));
                WRF_d2_NMAE_analogs_10(j)=mean(WRF_d2_NMAE_analogs_10(find(WRF_d2_NMAE_analogs_10~=0)) );
                WRF_d2_pearson_analogs_10(j)=mean(WRF_d2_pearson_analogs_10(find(WRF_d2_pearson_analogs_10~=0)));
                WRF_d2_spearman_rank_correltion_analogs_10(j)=mean(WRF_d2_spearman_rank_correltion_10(find(WRF_d2_spearman_rank_correltion_10~=0)))
           <span class="keyword">end</span>

    <span class="keyword">end</span> <span class="comment">% for lead times</span>

    exp_name_wrf=<span class="string">'Turbine_by_turbine_winter_1_mslp_wspd_wdir_rho_shear_domaine_1'</span>
    file_path=[<span class="string">'C:\Users\jnini\MATLAB\work\AnEn\data\workspace\WRF\out\experiments\'</span>,exp_name_wrf]
    load([file_path,<span class="string">'\turbine_time_series_for_nr_analogs_10'</span>]);Namelist{4}.nwp_model_domain=1
    leadtime_vector=get_leadtime_vector(turbine_time_series,Namelist)'
    [ analogs_lead_times_d1 ] = get_analog_lead_times( Namelist );

    <span class="comment">% gets the index where obervation are not missing for each turbine</span>
    [m n]=size(turbine_time_series)

    <span class="keyword">for</span> j=analogs_lead_times_d1
       obs=[];model=[];model_reg=[];model_raw=[];


        <span class="comment">% gets the index where obervation are not missing for each turbine</span>
    [m n]=size(turbine_time_series)
        <span class="keyword">for</span> i=1:n
          good_idx{i}=find(turbine_time_series(1,i).data{2,15}~=Namelist{1}.missing_value &amp; leadtime_vector==j)
          obs=vertcat(turbine_time_series(1,i).data{2,15}(good_idx{i}),obs);
          model=vertcat(turbine_time_series(1,i).data{2,2}(good_idx{i}),model);
          model_reg=vertcat(turbine_time_series(1,i).data{2,19}(good_idx{i}),model_reg);
          model_raw=vertcat(turbine_time_series(1,i).data{2,20}(good_idx{i}),model_raw);
        <span class="keyword">end</span>
           <span class="keyword">if</span> not(isempty(obs))
            <span class="keyword">if</span> Namelist{10}.normalize_errors
               [WRF_d1_rmse_analogs_10(j) WRF_d1_bias_analogs_10(j) WRF_d1_crmse_analogs_10(j)] = RMSEdecomp_all(obs/Namelist{10}.rated_capasity_kw, model/Namelist{10}.rated_capasity_kw);
                WRF_d1_NMAE_regresion(j)=mean(abs(obs-model_reg)/Namelist{10}.rated_capasity_kw)
                WRF_d1_NMAE_raw(j)=mean(abs(obs-model_raw)/Namelist{10}.rated_capasity_kw)

               [WRF_d1_rmse_regresion(j) WRF_d1_bias_regresion(j) WRF_d1_crmse_regresion(j)] = RMSEdecomp_all(obs/Namelist{10}.rated_capasity_kw, model_reg/Namelist{10}.rated_capasity_kw);
               WRF_d1_NMAE_regresion(j)=mean(abs(obs-model)/Namelist{10}.rated_capasity_kw)

                [WRF_d1_rmse_raw(j) WRF_d1_bias_raw(j) WRF_d1_crmse_raw(j)] = RMSEdecomp_all(obs/Namelist{10}.rated_capasity_kw, model_raw/Namelist{10}.rated_capasity_kw);
                WRF_d1_NMAE_analogs_10(j)=mean(abs(obs-model)/Namelist{10}.rated_capasity_kw)

                WRF_d1_pearson_analogs_10(j)=corr(obs,model, <span class="string">'Type'</span>, <span class="string">'Pearson'</span>);
                WRF_d1_pearson_regresion(j)=corr(obs,model_reg, <span class="string">'Type'</span>, <span class="string">'Pearson'</span>);
                WRF_d1_pearson_raw(j)=corr(obs,model_raw, <span class="string">'Type'</span>, <span class="string">'Pearson'</span>);

                WRF_d1_spearman_rank_correltion_10(j)=corr(obs,model, <span class="string">'Type'</span>, <span class="string">'Spearman'</span>);
                WRF_d1_spearman_rank_correltion_regresion(j)=corr(obs,model_reg, <span class="string">'Type'</span>, <span class="string">'Spearman'</span>);
                WRF_d1_spearman_rank_correltion_raw(j)=corr(obs,model_raw, <span class="string">'Type'</span>, <span class="string">'Spearman'</span>);

            <span class="keyword">else</span>
                [WRF_d1_rmse_analogs_10(j) WRF_d1_bias_analogs10(j) WRF_d1_crmse_10(j)] = RMSEdecomp_all(obs, model);
                WRF_d1_NMAE_10(j)=mean(abs(obs-model))
                WRF_d1_pearson_10(j)=corr(obs,model, <span class="string">'Type'</span>, <span class="string">'Pearson'</span>);
                WRF_d1_spearman_rank_correltion_10(j)=corr(obs,model, <span class="string">'Type'</span>, <span class="string">'Spearman'</span>);
            <span class="keyword">end</span>
           <span class="keyword">else</span> <span class="comment">% is empty</span>
                WRF_d1_rmse_analogs_10(j)=mean(WRF_d1_rmse_analogs_10(find(WRF_d1_rmse_analogs_10~=0)) );
                WRF_d1_bias_analogs10(j)=mean(WRF_d1_bias_analogs_10(find(WRF_d1_bias_analogs_10~=0)) );
                WRF_d1_crmse_analogs_10(j) = mean(WRF_d1_crmse_analogs_10(find(WRF_d1_crmse_analogs_10~=0)));
                WRF_d1_NMAE_analogs_10(j)=mean(WRF_d1_NMAE_analogs_10(find(WRF_d1_NMAE_analogs_10~=0)) );
                WRF_d1_pearson_analogs_10(j)=mean(WRF_d1_pearson_analogs_10(find(WRF_d1_pearson_analogs_10~=0)));
                WRF_d1_spearman_rank_correltion_analogs_10(j)=mean(WRF_d1_spearman_rank_correltion_10(find(WRF_d1_spearman_rank_correltion_10~=0)))

          <span class="keyword">end</span> <span class="comment">% isempty</span>

        <span class="keyword">for</span> dummy=1:length(analogs_lead_times_d1)
             lead_time_match_idx(dummy)=find(analogs_lead_times_d1(dummy)==analogs_lead_times_d3)
        <span class="keyword">end</span>
    <span class="keyword">end</span>
             mtx_nmae(:,1)=ETA_NMAE_analogs_10(:,analogs_lead_times_d3(lead_time_match_idx));mtx_nmae(:,:,2)=WRF_d3_NMAE_analogs_10(:,analogs_lead_times_d3(lead_time_match_idx));mtx_nmae(:,:,3)=WRF_d2_NMAE_analogs_10(:,analogs_lead_times_d2);mtx_nmae(:,:,4)=WRF_d1_NMAE_analogs_10(:,analogs_lead_times_d1);mtx_nmae(:,:,5)=WRF_d1_NMAE_regresion(:,analogs_lead_times_d1);mtx_nmae(:,:,6)=WRF_d1_NMAE_raw(:,analogs_lead_times_d1);mtx_nmae(:,:,7)=WRF_d2_NMAE_regresion(:,analogs_lead_times_d1);mtx_nmae(:,:,8)=WRF_d2_NMAE_raw(:,analogs_lead_times_d1);mtx_nmae(:,:,9)=WRF_d3_NMAE_regresion(:,analogs_lead_times_d1);mtx_nmae(:,:,10)=WRF_d3_NMAE_raw(:,analogs_lead_times_d1);mtx_nmae(:,:,11)=ETA_NMAE_regresion(:,analogs_lead_times_d1);mtx_nmae(:,:,12)=ETA_NMAE_raw(:,analogs_lead_times_d1);
             mtx_bias(:,1)=ETA_bias_analogs_10(:,analogs_lead_times_d3(lead_time_match_idx));mtx_bias(:,2)=WRF_d3_bias_analogs_10(:,analogs_lead_times_d3(lead_time_match_idx));mtx_bias(:,3)=WRF_d2_bias_analogs_10(:,analogs_lead_times_d2);mtx_bias(:,4)=WRF_d1_bias_analogs_10(:,analogs_lead_times_d1);mtx_bias(:,5)=WRF_d1_bias_regresion(:,analogs_lead_times_d1);mtx_bias(:,6)=WRF_d1_bias_raw(:,analogs_lead_times_d1)
             mtx_rmse(:,1)=ETA_rmse_analogs_10(:,analogs_lead_times_d3(lead_time_match_idx));mtx_rmse(:,2)=WRF_d3_rmse_analogs_10(:,analogs_lead_times_d3(lead_time_match_idx));mtx_rmse(:,3)=WRF_d2_rmse_analogs_10(:,analogs_lead_times_d2);mtx_rmse(:,4)=WRF_d1_rmse_analogs_10(:,analogs_lead_times_d1);mtx_rmse(:,5)=WRF_d1_rmse_regresion(:,analogs_lead_times_d1);mtx_rmse(:,6)=WRF_d1_rmse_raw(:,analogs_lead_times_d1);mtx_rmse(:,7)=WRF_d2_rmse_regresion(:,analogs_lead_times_d1);mtx_rmse(:,8)=WRF_d2_rmse_raw(:,analogs_lead_times_d1);mtx_rmse(:,9)=WRF_d3_rmse_regresion(:,analogs_lead_times_d1);mtx_rmse(:,10)=WRF_d3_rmse_raw(:,analogs_lead_times_d1);mtx_rmse(:,11)=ETA_rmse_regresion(:,analogs_lead_times_d1);mtx_rmse(:,12)=ETA_rmse_raw(:,analogs_lead_times_d1);
             mtx_rmse_2(:,1)=ETA_rmse_analogs_10(:,analogs_lead_times_d3(lead_time_match_idx));mtx_rmse(:,2)=ETA_rmse_regresion(:,analogs_lead_times_d3(lead_time_match_idx));mtx_rmse(:,3)=ETA_rmse_raw(:,analogs_lead_times_d2); <span class="keyword">...</span>
             mtx_rmse(:,4)=WRF_d3_rmse_analogs_10(:,analogs_lead_times_d1);mtx_rmse(:,5)=WRF_d3_rmse_regresion(:,analogs_lead_times_d1);mtx_rmse(:,6)=WRF_d3_rmse_raw(:,analogs_lead_times_d1); <span class="keyword">...</span>
             mtx_rmse(:,7)=WRF_d2_rmse_analogs_10(:,analogs_lead_times_d1);mtx_rmse(:,8)=WRF_d2_rmse_regresion(:,analogs_lead_times_d1);mtx_rmse(:,9)=WRF_d2_rmse_raw(:,analogs_lead_times_d1); <span class="keyword">...</span>
             mtx_rmse(:,10)=WRF_d1_rmse_analogs_10(:,analogs_lead_times_d1);mtx_rmse(:,11)=WRF_d1_rmse_regresion(:,analogs_lead_times_d1);mtx_rmse(:,10)=WRF_d1_rmse_raw(:,analogs_lead_times_d1); <span class="keyword">...</span>


             mtx_crmse(:,1)= ETA_crmse_analogs_10(:,analogs_lead_times_d3(lead_time_match_idx));mtx_crmse(:,:,2)=WRF_d3_crmse_analogs_10(:,analogs_lead_times_d3(lead_time_match_idx));mtx_crmse(:,:,3)=WRF_d2_crmse_analogs_10(:,analogs_lead_times_d2);mtx_crmse(:,:,4)=WRF_d1_crmse_analogs_10(:,analogs_lead_times_d1);mtx_crmse(:,:,5)=WRF_d1_crmse_raw(:,analogs_lead_times_d1);mtx_crmse(:,:,6)=WRF_d1_crmse_raw(:,analogs_lead_times_d1)
             mtx_pearson(:,1)=ETA_pearson_analogs_10(:,analogs_lead_times_d3(lead_time_match_idx));mtx_pearson(:,2)=WRF_d3_pearson_analogs_10(:,analogs_lead_times_d3(lead_time_match_idx));mtx_pearson(:,3)=WRF_d2_pearson_analogs_10(:,analogs_lead_times_d2);mtx_pearson(:,4)=WRF_d1_pearson_analogs_10(:,analogs_lead_times_d1);mtx_pearson(:,5)=WRF_d1_pearson_regresion(:,analogs_lead_times_d1);mtx_pearson(:,6)=WRF_d1_pearson_raw(:,analogs_lead_times_d1)
             mtx_spearman_rank_correltion(:,1)=ETA_spearman_rank_correltion_analogs_10(:,analogs_lead_times_d3(lead_time_match_idx));mtx_spearman_rank_correltion(:,2)=WRF_d3_spearman_rank_correltion_analogs_10(:,analogs_lead_times_d3(lead_time_match_idx));mtx_spearman_rank_correltion(:,3)=WRF_d2_spearman_rank_correltion_10(:,analogs_lead_times_d2);mtx_spearman_rank_correltion(:,4)=WRF_d1_spearman_rank_correltion_10(:,analogs_lead_times_d1);mtx_spearman_rank_correltion(:,5)=WRF_d1_spearman_rank_correltion_regresion(:,analogs_lead_times_d1);mtx_spearman_rank_correltion(:,6)=WRF_d1_spearman_rank_correltion_raw(:,analogs_lead_times_d1);mtx_spearman_rank_correltion(:,7)=WRF_d2_spearman_rank_correltion_regresion(:,analogs_lead_times_d1);mtx_spearman_rank_correltion(:,8)=WRF_d2_spearman_rank_correltion_raw(:,analogs_lead_times_d1);mtx_spearman_rank_correltion(:,9)=WRF_d3_spearman_rank_correltion_regresion(:,analogs_lead_times_d1);mtx_spearman_rank_correltion(:,10)=WRF_d3_spearman_rank_correltion_raw(:,analogs_lead_times_d1);mtx_spearman_rank_correltion(:,11)=ETA_spearman_rank_correltion_regresion(:,analogs_lead_times_d1);mtx_spearman_rank_correltion(:,12)=ETA_spearman_rank_correltion_raw(:,analogs_lead_times_d1)

            subplot (2,1,1)
               [m n] =size(mtx_nmae);
               <span class="keyword">for</span> i=1:n/3
                plotmtx=mtx_rmse(:,i);p=plot(plotmtx,[<span class="string">'-'</span> Namelist{5}.markers(i) Namelist{5}.color{7+i}]);
                hold <span class="string">on</span>;
               <span class="keyword">end</span>
                grid <span class="string">on</span>;ylabel(<span class="string">'NMAE'</span>,<span class="string">'fontsize'</span>,Namelist{7}.fontsize_sub_plot);
                xlabel(<span class="string">'Leadtime'</span>,<span class="string">'fontsize'</span>,Namelist{7}.fontsize_sub_plot);set(gca,<span class="string">'fontsize'</span>,Namelist{7}.fontsize_sub_plot,<span class="string">'ylim'</span>,[0.12 0.25],<span class="string">'xticklabel'</span>,analogs_lead_times_d3(lead_time_match_idx));
                legend({<span class="string">'ETA'</span>,<span class="string">'WRF-d3'</span>,<span class="string">'WRF-d2'</span>,<span class="string">'WRF-d1'</span>},<span class="string">'location'</span>,<span class="string">'northeast'</span>)

            subplot (2,1,2)
               [m n] =size(mtx_nmae);
               <span class="keyword">for</span> i=1:n
                plotmtx=mtx_nmae(:,i);p=plot(plotmtx,[<span class="string">'-'</span> Namelist{5}.markers(i) Namelist{5}.color{7+i}]);
                hold <span class="string">on</span>;
               <span class="keyword">end</span>
                grid <span class="string">on</span>;ylabel(<span class="string">'NMAE'</span>,<span class="string">'fontsize'</span>,Namelist{7}.fontsize_sub_plot);
                xlabel(<span class="string">'Leadtime'</span>,<span class="string">'fontsize'</span>,Namelist{7}.fontsize_sub_plot);set(gca,<span class="string">'fontsize'</span>,Namelist{7}.fontsize_sub_plot,<span class="string">'ylim'</span>,[0.12 0.25],<span class="string">'xticklabel'</span>,analogs_lead_times_d3(lead_time_match_idx));
                legend({<span class="string">'ETA'</span>,<span class="string">'WRF-d3'</span>,<span class="string">'WRF-d2'</span>,<span class="string">'WRF-d1'</span>},<span class="string">'location'</span>,<span class="string">'northeast'</span>)
            subplot (2,2,2)
               [m n] =size(mtx_bias);
               <span class="keyword">for</span> i=1:n
                plotmtx=mtx_bias(:,i);p=plot(plotmtx,[<span class="string">'-'</span> Namelist{5}.markers(i) Namelist{5}.color{7+i}]);
                hold <span class="string">on</span>;
               <span class="keyword">end</span>
                grid <span class="string">on</span>;ylabel(<span class="string">'BIAS'</span>,<span class="string">'fontsize'</span>,Namelist{7}.fontsize_sub_plot);
                set(gca,<span class="string">'fontsize'</span>,Namelist{7}.fontsize_sub_plot,<span class="string">'ylim'</span>,[-0.08 0.04],<span class="string">'xticklabel'</span>,analogs_lead_times_d3(lead_time_match_idx));
                xlabel(<span class="string">'Leadtime'</span>,<span class="string">'fontsize'</span>,Namelist{7}.fontsize_sub_plot)
                legend({<span class="string">'ETA'</span>,<span class="string">'WRF-d3'</span>,<span class="string">'WRF-d2'</span>,<span class="string">'WRF-d1'</span>},<span class="string">'location'</span>,<span class="string">'northeast'</span>)
            subplot (2,2,3)
               [m n] =size(mtx_nmae);
               <span class="keyword">for</span> i=1:n
                plotmtx=mtx_crmse(:,i);p=plot(plotmtx,[<span class="string">'-'</span> Namelist{5}.markers(i) Namelist{5}.color{7+i}]);
                hold <span class="string">on</span>;
               <span class="keyword">end</span>
                 grid <span class="string">on</span>;ylabel(<span class="string">'CRMSE'</span>,<span class="string">'fontsize'</span>,Namelist{7}.fontsize_sub_plot);
                 xlabel(<span class="string">'Leadtime'</span>,<span class="string">'fontsize'</span>,Namelist{7}.fontsize_sub_plot)
                 set(gca,<span class="string">'fontsize'</span>,Namelist{7}.fontsize_sub_plot,<span class="string">'ylim'</span>,[0.14 0.25],<span class="string">'xticklabel'</span>,analogs_lead_times_d3(lead_time_match_idx));
                legend({<span class="string">'ETA'</span>,<span class="string">'WRF-d3'</span>,<span class="string">'WRF-d2'</span>,<span class="string">'WRF-d1'</span>},<span class="string">'location'</span>,<span class="string">'northeast'</span>)

           subplot (2,2,4)
               [m n] =size(mtx_nmae);
               <span class="keyword">for</span> i=1:n
                plotmtx=mtx_spearman_rank_correltion(:,i);p=plot(plotmtx,[<span class="string">'-'</span> Namelist{5}.markers(i) Namelist{5}.color{7+i}]);
                hold <span class="string">on</span>;
               <span class="keyword">end</span>
               grid <span class="string">on</span>;ylabel(<span class="string">'Spearman correlation'</span>,<span class="string">'fontsize'</span>,Namelist{7}.fontsize_sub_plot);
               xlabel(<span class="string">'Leadtime'</span>,<span class="string">'fontsize'</span>,Namelist{7}.fontsize_sub_plot)
               set(gca,<span class="string">'fontsize'</span>,Namelist{7}.fontsize_sub_plot,<span class="string">'ylim'</span>,[0.35,0.85],<span class="string">'xticklabel'</span>,analogs_lead_times_d3(lead_time_match_idx));
               legend({<span class="string">'ETA'</span>,<span class="string">'WRF-d3'</span>,<span class="string">'WRF-d2'</span>,<span class="string">'WRF-d1'</span>},<span class="string">'location'</span>,<span class="string">'northeast'</span>)



        maximize
        save_dir=[Namelist{1}.stat_plot_dir,<span class="string">'\accuracy_nwp_turbine_concanated_on_leadtimes'</span>]
        plot_filename=[<span class="string">'\stats_on_nr_10_analogs_nwp_all_domaines_wrf_shear_turbine'</span>]
                <span class="keyword">if</span> isdir(save_dir)
                   saveas(gcf,[save_dir plot_filename] ,<span class="string">'fig'</span>)
                   saveas(gcf,[save_dir plot_filename] ,<span class="string">'jpeg'</span>)

                <span class="keyword">else</span>
                    mkdir(save_dir)
                    saveas(gcf,[save_dir plot_filename] ,<span class="string">'fig'</span>)
                    saveas(gcf,[save_dir plot_filename] ,<span class="string">'jpeg'</span>)

                <span class="keyword">end</span>
<span class="keyword">end</span> <span class="comment">% turbine Counter</span>
</pre><pre class="codeoutput">
exp_name =

Turbine_by_turbine_winter_1_mslp_wspd_wdir_rho_shear_domaine_3


file_path =

C:\Users\jnini\MATLAB\work\AnEn\data\workspace\ETA\out\experiments\Turbine_by_turbine_winter_1_mslp_wspd_wdir_rho_shear_domaine_3

</pre><pre class="codeoutput">Input argument "Namelist" is undefined.

Error in ==&gt; do_accuracy_concanated_turbines_benchmarking_10_analogs at 8
    leadtime_vector=get_leadtime_vector(turbine_time_series,Namelist)'
</pre><p class="footer"><br>
      Published with MATLAB&reg; 7.10<br></p></div><!--
##### SOURCE BEGIN #####
function [ succes ] = do_accuracy_concanated_turbines_benchmarking_10_analogs( Namelist )
%DO_ACCURACY_NWP_ANALYSIS Summary of this function goes here
%   Detailed explanation goes here
close all
    exp_name='Turbine_by_turbine_winter_1_mslp_wspd_wdir_rho_shear_domaine_3' % this is bad and should be cahnged 14/05
    file_path=['C:\Users\jnini\MATLAB\work\AnEn\data\workspace\ETA\out\experiments\',exp_name]
    load([file_path,'\turbine_time_series_for_nr_analogs_10'])
    leadtime_vector=get_leadtime_vector(turbine_time_series,Namelist)'
    [ analogs_lead_times ] = get_analog_lead_times( Namelist );

    for j=analogs_lead_times
        obs=[];model=[];model_reg=[];model_raw=[];
        [m n]=size(turbine_time_series)
        for i=1:n
            % concanate loop
            good_idx{i}=find(turbine_time_series(1,i).data{2,15}~=Namelist{1}.missing_value & leadtime_vector==j);
            obs=vertcat(turbine_time_series(1,i).data{2,15}(good_idx{i}),obs);
            model=vertcat(turbine_time_series(1,i).data{2,2}(good_idx{i}),model);
            model_reg=vertcat(turbine_time_series(1,i).data{2,19}(good_idx{i}),model_reg);
            model_raw=vertcat(turbine_time_series(1,i).data{2,20}(good_idx{i}),model_raw);
        end
        
        if not(isempty(obs))
                if Namelist{10}.normalize_errors
                   [ETA_rmse_analogs_10(j) ETA_bias_analogs_10(j) ETA_crmse_analogs_10(j)] = RMSEdecomp_all(obs/Namelist{10}.rated_capasity_kw, model/Namelist{10}.rated_capasity_kw);
                   [ETA_rmse_regresion(j) ETA_bias_regresion(j) ETA_crmse_regresion(j)] = RMSEdecomp_all(obs/Namelist{10}.rated_capasity_kw, model_reg/Namelist{10}.rated_capasity_kw);
                   [ETA_rmse_raw(j) ETA_bias_raw(j) ETA_crmse_raw(j)] = RMSEdecomp_all(obs/Namelist{10}.rated_capasity_kw, model_raw/Namelist{10}.rated_capasity_kw);
                   
                   ETA_NMAE_analogs_10(j)=mean(abs(obs-model)/Namelist{10}.rated_capasity_kw);
                   ETA_NMAE_regresion(j)=mean(abs(obs-model_reg)/Namelist{10}.rated_capasity_kw);
                   ETA_NMAE_raw(j)=mean(abs(obs-model_raw)/Namelist{10}.rated_capasity_kw);
                    ETA_pearson_analogs_10(j)=corr(obs,model, 'Type', 'Pearson');
                    ETA_pearson_regresion(j)=corr(obs,model_reg, 'Type', 'Pearson');
                    ETA_pearson_raw(j)=corr(obs,model_raw, 'Type', 'Pearson');
      
                    ETA_spearman_rank_correltion_analogs_10(j)=corr(obs,model, 'Type', 'Spearman');
                    ETA_spearman_rank_correltion_regresion(j)=corr(obs,model_reg, 'Type', 'Spearman');
                    ETA_spearman_rank_correltion_raw(j)=corr(obs,model_raw, 'Type', 'Spearman');
                else
                   [ETA_rmse_regresion(j) ETA_bias_analogs10(j) ETA_crmse_10(j)] = RMSEdecomp_all(obs, model);
                    ETA_NMAE_10(j)=mean(abs(obs-model))
                    ETA_pearson_10(j)=corr(obs,model, 'Type', 'Pearson');
                    ETA_spearman_rank_correltion_10(j)=corr(obs,model, 'Type', 'Spearman');
                end
        else %isempty
                     ETA_rmse_analogs_10(j) =mean(ETA_rmse_analogs_10(12:j-1));
                     ETA_bias_analogs10(j) =mean(ETA_bias_analogs_10(12:j-1));
                     ETA_crmse_analogs_10(j) = mean(ETA_rmse_analogs_10(12:j-1));
                     ETA_NMAE_analogs_10(j)=mean(ETA_NMAE_analogs_10(12:j-1));
                     ETA_spearman_rank_correltion_analogs_10(j)=mean(ETA_spearman_rank_correltion_analogs_10(12:j-1))
                     
                     ETA_rmse_regresion(j) =mean(ETA_rmse_regresion(12:j-1));
                     ETA_bias_regresion(j) =mean(ETA_bias_regresion(12:j-1));
                     ETA_crmse_regresion(j) = mean(ETA_rmse_regresion(12:j-1));
                     ETA_NMAE_regresion(j)=mean(ETA_NMAE_regresion(12:j-1));
                     ETA_spearman_rank_correltion_regresion(j)=mean(ETA_spearman_rank_correltion_regresion(12:j-1))
                   
                     ETA_rmse_raw(j) =mean(ETA_rmse_raw(12:j-1));
                     ETA_bias_raw(j) =mean(ETA_bias_raw(12:j-1));
                     ETA_crmse_raw(j) = mean(ETA_rmse_raw(12:j-1));
                     ETA_NMAE_raw(j)=mean(ETA_NMAE_raw(12:j-1));
                     ETA_spearman_rank_correltion_raw(j)=mean(ETA_spearman_rank_correltion_raw(12:j-1))
        end
 end
    
    clear turbine_time_series;clear obs;clear model
    exp_name_wrf='Turbine_by_turbine_winter_1_mslp_wspd_wdir_rho_shear_domaine_3'
    file_path=['C:\Users\jnini\MATLAB\work\AnEn\data\workspace\WRF\out\experiments\',exp_name_wrf]
    load([file_path,'\turbine_time_series_for_nr_analogs_10']);Namelist{4}.nwp_model_domain=3;Namelist{4}.nwp_model{1}='WRF'
    leadtime_vector=get_leadtime_vector(turbine_time_series,Namelist)'
    [ analogs_lead_times_d3 ] = get_analog_lead_times( Namelist );
    
    for j=analogs_lead_times
        obs=[];model=[];model_reg=[];model_raw=[];
        
    % gets the index where obervation are not missing for each turbine 
    [m n]=size(turbine_time_series)    
        for i=1:n
             % concanate loop
            good_idx{i}=find(turbine_time_series(1,i).data{2,15}~=Namelist{1}.missing_value & leadtime_vector==j);
            obs=vertcat(turbine_time_series(1,i).data{2,15}(good_idx{i}),obs);
            model=vertcat(turbine_time_series(1,i).data{2,2}(good_idx{i}),model);
            model_reg=vertcat(turbine_time_series(1,i).data{2,19}(good_idx{i}),model_reg);
            model_raw=vertcat(turbine_time_series(1,i).data{2,20}(good_idx{i}),model_raw);
        end
           if not(isempty(good_idx{i}))
            if Namelist{10}.normalize_errors
                [WRF_d3_rmse_analogs_10(j) WRF_d3_bias_analogs_10(j) WRF_d3_crmse_analogs_10(j)] = RMSEdecomp_all(obs/Namelist{10}.rated_capasity_kw, model/Namelist{10}.rated_capasity_kw);
                WRF_d3_NMAE_regresion(j)=mean(abs(obs-model_reg)/Namelist{10}.rated_capasity_kw)
                WRF_d3_NMAE_raw(j)=mean(abs(obs-model_raw)/Namelist{10}.rated_capasity_kw)
           
                [WRF_d3_rmse_regresion(j) WRF_d3_bias_regresion(j) WRF_d3_crmse_regresion(j)] = RMSEdecomp_all(obs/Namelist{10}.rated_capasity_kw, model_reg/Namelist{10}.rated_capasity_kw);
                WRF_d3_NMAE_regresion(j)=mean(abs(obs-model)/Namelist{10}.rated_capasity_kw)
                [WRF_d3_rmse_raw(j) WRF_d3_bias_raw(j) WRF_d3_crmse_raw(j)] = RMSEdecomp_all(obs/Namelist{10}.rated_capasity_kw, model_raw/Namelist{10}.rated_capasity_kw);
                WRF_d3_NMAE_analogs_10(j)=mean(abs(obs-model)/Namelist{10}.rated_capasity_kw)
                WRF_d3_pearson_analogs_10(j)=corr(obs,model, 'Type', 'Pearson');
                WRF_d3_pearson_regresion(j)=corr(obs,model_reg, 'Type', 'Pearson');
                WRF_d3_pearson_raw(j)=corr(obs,model_raw, 'Type', 'Pearson');
                WRF_d3_spearman_rank_correltion_analogs_10(j)=corr(obs,model, 'Type', 'Spearman');
                WRF_d3_spearman_rank_correltion_regresion(j)=corr(obs,model_reg, 'Type', 'Spearman');
                WRF_d3_spearman_rank_correltion_raw(j)=corr(obs,model_raw, 'Type', 'Spearman');
                
            else
                [WRF_d3_rmse_analogs_10(j) WRF_d3_bias_analogs10(j) WRF_d3_crmse_10(j)] = RMSEdecomp_all(obs, model);
                WRF_d3_NMAE_10(j)=mean(abs(obs-model))
                WRF_d3_pearson_10(j)=corr(obs,model, 'Type', 'Pearson');
                WRF_d3_spearman_rank_correltion_10(j)=corr(obs,model, 'Type', 'Spearman');
            end % normalize
            
           else % is empty 
                WRF_d3_rmse_analogs_10(j)=mean(WRF_d3_rmse_analogs_10(12:j-1)) 
                 WRF_d3_bias_analogs10(j)=mean(WRF_d3_bias_analogs_10(12:j-1)) 
                 WRF_d3_crmse_analogs_10(j) = mean(WRF_d3_crmse_analogs_10(12:j-1))
                WRF_d3_NMAE_analogs_10(j)=mean(WRF_d3_NMAE_analogs_10(12:j-1))
                WRF_d3_pearson_analogs_10(j)=mean(WRF_d3_pearson_analogs_10(12:j-1))
                WRF_d3_spearman_rank_correltion_analogs_10(j)=mean(WRF_d3_spearman_rank_correltion_analogs_10(12:j-1))
           end % is empty    
    end % lead time

    exp_name_wrf='Turbine_by_turbine_winter_1_mslp_wspd_wdir_rho_shear_domaine_2'
    file_path=['C:\Users\jnini\MATLAB\work\AnEn\data\workspace\WRF\out\experiments\',exp_name_wrf]
    load([file_path,'\turbine_time_series_for_nr_analogs_10'])
    Namelist{4}.nwp_model_domain=2
    leadtime_vector=get_leadtime_vector(turbine_time_series,Namelist)'
    [ analogs_lead_times_d2 ] = get_analog_lead_times( Namelist );
   
    % gets the index where obervation are not missing for each turbine 
    for j=analogs_lead_times_d2
        obs=[];model=[];model_reg=[];model_raw=[];
    
    % gets the index where obervation are not missing for each turbine 
    [m n]=size(turbine_time_series)    
        for i=1:n
            good_idx{i}=find(turbine_time_series(1,i).data{2,15}~=Namelist{1}.missing_value & leadtime_vector==j);
            obs=vertcat(turbine_time_series(1,i).data{2,15}(good_idx{i}),obs);
            model=vertcat(turbine_time_series(1,i).data{2,2}(good_idx{i}),model);
            model_reg=vertcat(turbine_time_series(1,i).data{2,19}(good_idx{i}),model_reg);
            model_raw=vertcat(turbine_time_series(1,i).data{2,20}(good_idx{i}),model_raw);
        end % turbine id 
           if not(isempty(obs))
             if Namelist{10}.normalize_errors
                [WRF_d2_rmse_analogs_10(j) WRF_d2_bias_analogs_10(j) WRF_d2_crmse_analogs_10(j)] = RMSEdecomp_all(obs/Namelist{10}.rated_capasity_kw, model/Namelist{10}.rated_capasity_kw);
                WRF_d2_NMAE_regresion(j)=mean(abs(obs-model_reg)/Namelist{10}.rated_capasity_kw)
                WRF_d2_NMAE_raw(j)=mean(abs(obs-model_raw)/Namelist{10}.rated_capasity_kw)
                
               [WRF_d2_rmse_regresion(j) WRF_d2_bias_regresion(j) WRF_d2_crmse_regresion(j)] = RMSEdecomp_all(obs/Namelist{10}.rated_capasity_kw, model_reg/Namelist{10}.rated_capasity_kw);
               WRF_d2_NMAE_regresion(j)=mean(abs(obs-model)/Namelist{10}.rated_capasity_kw)
                
                [WRF_d2_rmse_raw(j) WRF_d2_bias_raw(j) WRF_d2_crmse_raw(j)] = RMSEdecomp_all(obs/Namelist{10}.rated_capasity_kw, model_raw/Namelist{10}.rated_capasity_kw);
                WRF_d2_NMAE_analogs_10(j)=mean(abs(obs-model)/Namelist{10}.rated_capasity_kw)
                
                WRF_d2_pearson_analogs_10(j)=corr(obs,model, 'Type', 'Pearson');
                WRF_d2_pearson_regresion(j)=corr(obs,model_reg, 'Type', 'Pearson');
                WRF_d2_pearson_raw(j)=corr(obs,model_raw, 'Type', 'Pearson');
                
                WRF_d2_spearman_rank_correltion_10(j)=corr(obs,model, 'Type', 'Spearman');
                WRF_d2_spearman_rank_correltion_regresion(j)=corr(obs,model_reg, 'Type', 'Spearman');
                WRF_d2_spearman_rank_correltion_raw(j)=corr(obs,model_raw, 'Type', 'Spearman');
                
            else
                [WRF_d2_rmse_analogs_10(j) WRF_d2_bias_analogs10(j) WRF_d2_crmse_10(j)] = RMSEdecomp_all(obs, model);
                WRF_d2_NMAE_10(j)=mean(abs(obs-model))
                WRF_d2_pearson_10(j)=corr(obs,model, 'Type', 'Pearson');
                WRF_d2_spearman_rank_correltion_10(j)=corr(obs,model, 'Type', 'Spearman');
            end
           else % is empty 
                WRF_d2_rmse_analogs_10(j)=mean(WRF_d2_rmse_analogs_10(find(WRF_d2_rmse_analogs_10~=0)) );
                WRF_d2_bias_analogs10(j)=mean(WRF_d2_bias_analogs_10(find(WRF_d2_bias_analogs_10~=0)) );
                WRF_d2_crmse_analogs_10(j) = mean(WRF_d2_crmse_analogs_10(find(WRF_d2_crmse_analogs_10~=0)));
                WRF_d2_NMAE_analogs_10(j)=mean(WRF_d2_NMAE_analogs_10(find(WRF_d2_NMAE_analogs_10~=0)) );
                WRF_d2_pearson_analogs_10(j)=mean(WRF_d2_pearson_analogs_10(find(WRF_d2_pearson_analogs_10~=0)));
                WRF_d2_spearman_rank_correltion_analogs_10(j)=mean(WRF_d2_spearman_rank_correltion_10(find(WRF_d2_spearman_rank_correltion_10~=0)))
           end
            
    end % for lead times 

    exp_name_wrf='Turbine_by_turbine_winter_1_mslp_wspd_wdir_rho_shear_domaine_1'
    file_path=['C:\Users\jnini\MATLAB\work\AnEn\data\workspace\WRF\out\experiments\',exp_name_wrf]
    load([file_path,'\turbine_time_series_for_nr_analogs_10']);Namelist{4}.nwp_model_domain=1
    leadtime_vector=get_leadtime_vector(turbine_time_series,Namelist)'
    [ analogs_lead_times_d1 ] = get_analog_lead_times( Namelist );
    
    % gets the index where obervation are not missing for each turbine 
    [m n]=size(turbine_time_series)    

    for j=analogs_lead_times_d1
       obs=[];model=[];model_reg=[];model_raw=[];
    
        
        % gets the index where obervation are not missing for each turbine 
    [m n]=size(turbine_time_series)    
        for i=1:n
          good_idx{i}=find(turbine_time_series(1,i).data{2,15}~=Namelist{1}.missing_value & leadtime_vector==j)
          obs=vertcat(turbine_time_series(1,i).data{2,15}(good_idx{i}),obs);
          model=vertcat(turbine_time_series(1,i).data{2,2}(good_idx{i}),model);
          model_reg=vertcat(turbine_time_series(1,i).data{2,19}(good_idx{i}),model_reg);
          model_raw=vertcat(turbine_time_series(1,i).data{2,20}(good_idx{i}),model_raw);
        end
           if not(isempty(obs))
            if Namelist{10}.normalize_errors
               [WRF_d1_rmse_analogs_10(j) WRF_d1_bias_analogs_10(j) WRF_d1_crmse_analogs_10(j)] = RMSEdecomp_all(obs/Namelist{10}.rated_capasity_kw, model/Namelist{10}.rated_capasity_kw);
                WRF_d1_NMAE_regresion(j)=mean(abs(obs-model_reg)/Namelist{10}.rated_capasity_kw)
                WRF_d1_NMAE_raw(j)=mean(abs(obs-model_raw)/Namelist{10}.rated_capasity_kw)
                
               [WRF_d1_rmse_regresion(j) WRF_d1_bias_regresion(j) WRF_d1_crmse_regresion(j)] = RMSEdecomp_all(obs/Namelist{10}.rated_capasity_kw, model_reg/Namelist{10}.rated_capasity_kw);
               WRF_d1_NMAE_regresion(j)=mean(abs(obs-model)/Namelist{10}.rated_capasity_kw)
                
                [WRF_d1_rmse_raw(j) WRF_d1_bias_raw(j) WRF_d1_crmse_raw(j)] = RMSEdecomp_all(obs/Namelist{10}.rated_capasity_kw, model_raw/Namelist{10}.rated_capasity_kw);
                WRF_d1_NMAE_analogs_10(j)=mean(abs(obs-model)/Namelist{10}.rated_capasity_kw)
                
                WRF_d1_pearson_analogs_10(j)=corr(obs,model, 'Type', 'Pearson');
                WRF_d1_pearson_regresion(j)=corr(obs,model_reg, 'Type', 'Pearson');
                WRF_d1_pearson_raw(j)=corr(obs,model_raw, 'Type', 'Pearson');
                
                WRF_d1_spearman_rank_correltion_10(j)=corr(obs,model, 'Type', 'Spearman');
                WRF_d1_spearman_rank_correltion_regresion(j)=corr(obs,model_reg, 'Type', 'Spearman');
                WRF_d1_spearman_rank_correltion_raw(j)=corr(obs,model_raw, 'Type', 'Spearman');
                
            else
                [WRF_d1_rmse_analogs_10(j) WRF_d1_bias_analogs10(j) WRF_d1_crmse_10(j)] = RMSEdecomp_all(obs, model);
                WRF_d1_NMAE_10(j)=mean(abs(obs-model))
                WRF_d1_pearson_10(j)=corr(obs,model, 'Type', 'Pearson');
                WRF_d1_spearman_rank_correltion_10(j)=corr(obs,model, 'Type', 'Spearman');
            end
           else % is empty 
                WRF_d1_rmse_analogs_10(j)=mean(WRF_d1_rmse_analogs_10(find(WRF_d1_rmse_analogs_10~=0)) );
                WRF_d1_bias_analogs10(j)=mean(WRF_d1_bias_analogs_10(find(WRF_d1_bias_analogs_10~=0)) );
                WRF_d1_crmse_analogs_10(j) = mean(WRF_d1_crmse_analogs_10(find(WRF_d1_crmse_analogs_10~=0)));
                WRF_d1_NMAE_analogs_10(j)=mean(WRF_d1_NMAE_analogs_10(find(WRF_d1_NMAE_analogs_10~=0)) );
                WRF_d1_pearson_analogs_10(j)=mean(WRF_d1_pearson_analogs_10(find(WRF_d1_pearson_analogs_10~=0)));
                WRF_d1_spearman_rank_correltion_analogs_10(j)=mean(WRF_d1_spearman_rank_correltion_10(find(WRF_d1_spearman_rank_correltion_10~=0)))
                
          end % isempty
          
        for dummy=1:length(analogs_lead_times_d1)
             lead_time_match_idx(dummy)=find(analogs_lead_times_d1(dummy)==analogs_lead_times_d3)        
        end
    end
             mtx_nmae(:,1)=ETA_NMAE_analogs_10(:,analogs_lead_times_d3(lead_time_match_idx));mtx_nmae(:,:,2)=WRF_d3_NMAE_analogs_10(:,analogs_lead_times_d3(lead_time_match_idx));mtx_nmae(:,:,3)=WRF_d2_NMAE_analogs_10(:,analogs_lead_times_d2);mtx_nmae(:,:,4)=WRF_d1_NMAE_analogs_10(:,analogs_lead_times_d1);mtx_nmae(:,:,5)=WRF_d1_NMAE_regresion(:,analogs_lead_times_d1);mtx_nmae(:,:,6)=WRF_d1_NMAE_raw(:,analogs_lead_times_d1);mtx_nmae(:,:,7)=WRF_d2_NMAE_regresion(:,analogs_lead_times_d1);mtx_nmae(:,:,8)=WRF_d2_NMAE_raw(:,analogs_lead_times_d1);mtx_nmae(:,:,9)=WRF_d3_NMAE_regresion(:,analogs_lead_times_d1);mtx_nmae(:,:,10)=WRF_d3_NMAE_raw(:,analogs_lead_times_d1);mtx_nmae(:,:,11)=ETA_NMAE_regresion(:,analogs_lead_times_d1);mtx_nmae(:,:,12)=ETA_NMAE_raw(:,analogs_lead_times_d1);
             mtx_bias(:,1)=ETA_bias_analogs_10(:,analogs_lead_times_d3(lead_time_match_idx));mtx_bias(:,2)=WRF_d3_bias_analogs_10(:,analogs_lead_times_d3(lead_time_match_idx));mtx_bias(:,3)=WRF_d2_bias_analogs_10(:,analogs_lead_times_d2);mtx_bias(:,4)=WRF_d1_bias_analogs_10(:,analogs_lead_times_d1);mtx_bias(:,5)=WRF_d1_bias_regresion(:,analogs_lead_times_d1);mtx_bias(:,6)=WRF_d1_bias_raw(:,analogs_lead_times_d1)
             mtx_rmse(:,1)=ETA_rmse_analogs_10(:,analogs_lead_times_d3(lead_time_match_idx));mtx_rmse(:,2)=WRF_d3_rmse_analogs_10(:,analogs_lead_times_d3(lead_time_match_idx));mtx_rmse(:,3)=WRF_d2_rmse_analogs_10(:,analogs_lead_times_d2);mtx_rmse(:,4)=WRF_d1_rmse_analogs_10(:,analogs_lead_times_d1);mtx_rmse(:,5)=WRF_d1_rmse_regresion(:,analogs_lead_times_d1);mtx_rmse(:,6)=WRF_d1_rmse_raw(:,analogs_lead_times_d1);mtx_rmse(:,7)=WRF_d2_rmse_regresion(:,analogs_lead_times_d1);mtx_rmse(:,8)=WRF_d2_rmse_raw(:,analogs_lead_times_d1);mtx_rmse(:,9)=WRF_d3_rmse_regresion(:,analogs_lead_times_d1);mtx_rmse(:,10)=WRF_d3_rmse_raw(:,analogs_lead_times_d1);mtx_rmse(:,11)=ETA_rmse_regresion(:,analogs_lead_times_d1);mtx_rmse(:,12)=ETA_rmse_raw(:,analogs_lead_times_d1);
             mtx_rmse_2(:,1)=ETA_rmse_analogs_10(:,analogs_lead_times_d3(lead_time_match_idx));mtx_rmse(:,2)=ETA_rmse_regresion(:,analogs_lead_times_d3(lead_time_match_idx));mtx_rmse(:,3)=ETA_rmse_raw(:,analogs_lead_times_d2); ...
             mtx_rmse(:,4)=WRF_d3_rmse_analogs_10(:,analogs_lead_times_d1);mtx_rmse(:,5)=WRF_d3_rmse_regresion(:,analogs_lead_times_d1);mtx_rmse(:,6)=WRF_d3_rmse_raw(:,analogs_lead_times_d1); ...
             mtx_rmse(:,7)=WRF_d2_rmse_analogs_10(:,analogs_lead_times_d1);mtx_rmse(:,8)=WRF_d2_rmse_regresion(:,analogs_lead_times_d1);mtx_rmse(:,9)=WRF_d2_rmse_raw(:,analogs_lead_times_d1); ...
             mtx_rmse(:,10)=WRF_d1_rmse_analogs_10(:,analogs_lead_times_d1);mtx_rmse(:,11)=WRF_d1_rmse_regresion(:,analogs_lead_times_d1);mtx_rmse(:,10)=WRF_d1_rmse_raw(:,analogs_lead_times_d1); ...
             
            
             mtx_crmse(:,1)= ETA_crmse_analogs_10(:,analogs_lead_times_d3(lead_time_match_idx));mtx_crmse(:,:,2)=WRF_d3_crmse_analogs_10(:,analogs_lead_times_d3(lead_time_match_idx));mtx_crmse(:,:,3)=WRF_d2_crmse_analogs_10(:,analogs_lead_times_d2);mtx_crmse(:,:,4)=WRF_d1_crmse_analogs_10(:,analogs_lead_times_d1);mtx_crmse(:,:,5)=WRF_d1_crmse_raw(:,analogs_lead_times_d1);mtx_crmse(:,:,6)=WRF_d1_crmse_raw(:,analogs_lead_times_d1)
             mtx_pearson(:,1)=ETA_pearson_analogs_10(:,analogs_lead_times_d3(lead_time_match_idx));mtx_pearson(:,2)=WRF_d3_pearson_analogs_10(:,analogs_lead_times_d3(lead_time_match_idx));mtx_pearson(:,3)=WRF_d2_pearson_analogs_10(:,analogs_lead_times_d2);mtx_pearson(:,4)=WRF_d1_pearson_analogs_10(:,analogs_lead_times_d1);mtx_pearson(:,5)=WRF_d1_pearson_regresion(:,analogs_lead_times_d1);mtx_pearson(:,6)=WRF_d1_pearson_raw(:,analogs_lead_times_d1)
             mtx_spearman_rank_correltion(:,1)=ETA_spearman_rank_correltion_analogs_10(:,analogs_lead_times_d3(lead_time_match_idx));mtx_spearman_rank_correltion(:,2)=WRF_d3_spearman_rank_correltion_analogs_10(:,analogs_lead_times_d3(lead_time_match_idx));mtx_spearman_rank_correltion(:,3)=WRF_d2_spearman_rank_correltion_10(:,analogs_lead_times_d2);mtx_spearman_rank_correltion(:,4)=WRF_d1_spearman_rank_correltion_10(:,analogs_lead_times_d1);mtx_spearman_rank_correltion(:,5)=WRF_d1_spearman_rank_correltion_regresion(:,analogs_lead_times_d1);mtx_spearman_rank_correltion(:,6)=WRF_d1_spearman_rank_correltion_raw(:,analogs_lead_times_d1);mtx_spearman_rank_correltion(:,7)=WRF_d2_spearman_rank_correltion_regresion(:,analogs_lead_times_d1);mtx_spearman_rank_correltion(:,8)=WRF_d2_spearman_rank_correltion_raw(:,analogs_lead_times_d1);mtx_spearman_rank_correltion(:,9)=WRF_d3_spearman_rank_correltion_regresion(:,analogs_lead_times_d1);mtx_spearman_rank_correltion(:,10)=WRF_d3_spearman_rank_correltion_raw(:,analogs_lead_times_d1);mtx_spearman_rank_correltion(:,11)=ETA_spearman_rank_correltion_regresion(:,analogs_lead_times_d1);mtx_spearman_rank_correltion(:,12)=ETA_spearman_rank_correltion_raw(:,analogs_lead_times_d1)

            subplot (2,1,1)
               [m n] =size(mtx_nmae);
               for i=1:n/3
                plotmtx=mtx_rmse(:,i);p=plot(plotmtx,['-' Namelist{5}.markers(i) Namelist{5}.color{7+i}]);
                hold on;
               end
                grid on;ylabel('NMAE','fontsize',Namelist{7}.fontsize_sub_plot);
                xlabel('Leadtime','fontsize',Namelist{7}.fontsize_sub_plot);set(gca,'fontsize',Namelist{7}.fontsize_sub_plot,'ylim',[0.12 0.25],'xticklabel',analogs_lead_times_d3(lead_time_match_idx));
                legend({'ETA','WRF-d3','WRF-d2','WRF-d1'},'location','northeast')

            subplot (2,1,2)
               [m n] =size(mtx_nmae);
               for i=1:n
                plotmtx=mtx_nmae(:,i);p=plot(plotmtx,['-' Namelist{5}.markers(i) Namelist{5}.color{7+i}]);
                hold on;
               end
                grid on;ylabel('NMAE','fontsize',Namelist{7}.fontsize_sub_plot);
                xlabel('Leadtime','fontsize',Namelist{7}.fontsize_sub_plot);set(gca,'fontsize',Namelist{7}.fontsize_sub_plot,'ylim',[0.12 0.25],'xticklabel',analogs_lead_times_d3(lead_time_match_idx));
                legend({'ETA','WRF-d3','WRF-d2','WRF-d1'},'location','northeast')
            subplot (2,2,2)
               [m n] =size(mtx_bias);
               for i=1:n
                plotmtx=mtx_bias(:,i);p=plot(plotmtx,['-' Namelist{5}.markers(i) Namelist{5}.color{7+i}]);
                hold on;
               end
                grid on;ylabel('BIAS','fontsize',Namelist{7}.fontsize_sub_plot);
                set(gca,'fontsize',Namelist{7}.fontsize_sub_plot,'ylim',[-0.08 0.04],'xticklabel',analogs_lead_times_d3(lead_time_match_idx));
                xlabel('Leadtime','fontsize',Namelist{7}.fontsize_sub_plot)
                legend({'ETA','WRF-d3','WRF-d2','WRF-d1'},'location','northeast')
            subplot (2,2,3)
               [m n] =size(mtx_nmae);
               for i=1:n
                plotmtx=mtx_crmse(:,i);p=plot(plotmtx,['-' Namelist{5}.markers(i) Namelist{5}.color{7+i}]);
                hold on;
               end
                 grid on;ylabel('CRMSE','fontsize',Namelist{7}.fontsize_sub_plot);
                 xlabel('Leadtime','fontsize',Namelist{7}.fontsize_sub_plot)
                 set(gca,'fontsize',Namelist{7}.fontsize_sub_plot,'ylim',[0.14 0.25],'xticklabel',analogs_lead_times_d3(lead_time_match_idx));
                legend({'ETA','WRF-d3','WRF-d2','WRF-d1'},'location','northeast')
           
           subplot (2,2,4)
               [m n] =size(mtx_nmae);
               for i=1:n
                plotmtx=mtx_spearman_rank_correltion(:,i);p=plot(plotmtx,['-' Namelist{5}.markers(i) Namelist{5}.color{7+i}]);
                hold on;
               end
               grid on;ylabel('Spearman correlation','fontsize',Namelist{7}.fontsize_sub_plot);
               xlabel('Leadtime','fontsize',Namelist{7}.fontsize_sub_plot)
               set(gca,'fontsize',Namelist{7}.fontsize_sub_plot,'ylim',[0.35,0.85],'xticklabel',analogs_lead_times_d3(lead_time_match_idx));
               legend({'ETA','WRF-d3','WRF-d2','WRF-d1'},'location','northeast')



        maximize
        save_dir=[Namelist{1}.stat_plot_dir,'\accuracy_nwp_turbine_concanated_on_leadtimes']
        plot_filename=['\stats_on_nr_10_analogs_nwp_all_domaines_wrf_shear_turbine']
                if isdir(save_dir)
                   saveas(gcf,[save_dir plot_filename] ,'fig')
                   saveas(gcf,[save_dir plot_filename] ,'jpeg')

                else
                    mkdir(save_dir)
                    saveas(gcf,[save_dir plot_filename] ,'fig')
                    saveas(gcf,[save_dir plot_filename] ,'jpeg')

                end
end % turbine Counter





##### SOURCE END #####
--></body></html>